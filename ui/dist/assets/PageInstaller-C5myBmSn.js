import{S as G,i as J,s as Q,F as R,d as S,t as E,a as j,m as D,c as K,r as M,g as V,p as P,b as X,e as Y,f as N,h as m,j as Z,k as F,l as h,n as z,o as L,q as x,u as w,v as q,w as r,x as ee,y as W,z as B,A as O,B as te}from"./index-Ct9kKGrz.js";function ne(s){let t,u,o,n,e,p,_,d;return{c(){t=w("label"),u=O("Email"),n=q(),e=w("input"),r(t,"for",o=s[20]),r(e,"type","email"),r(e,"autocomplete","off"),r(e,"id",p=s[20]),e.disabled=s[7],e.required=!0},m(a,i){h(a,t,i),z(t,u),h(a,n,i),h(a,e,i),s[11](e),B(e,s[2]),_||(d=L(e,"input",s[12]),_=!0)},p(a,i){i&1048576&&o!==(o=a[20])&&r(t,"for",o),i&1048576&&p!==(p=a[20])&&r(e,"id",p),i&128&&(e.disabled=a[7]),i&4&&e.value!==a[2]&&B(e,a[2])},d(a){a&&(m(t),m(n),m(e)),s[11](null),_=!1,d()}}}function le(s){let t,u,o,n,e,p,_,d,a,i;return{c(){t=w("label"),u=O("密码"),n=q(),e=w("input"),_=q(),d=w("div"),d.textContent="建议至少10个字符.",r(t,"for",o=s[20]),r(e,"type","password"),r(e,"autocomplete","new-password"),r(e,"minlength","10"),r(e,"id",p=s[20]),e.disabled=s[7],e.required=!0,r(d,"class","help-block")},m(c,g){h(c,t,g),z(t,u),h(c,n,g),h(c,e,g),B(e,s[3]),h(c,_,g),h(c,d,g),a||(i=L(e,"input",s[13]),a=!0)},p(c,g){g&1048576&&o!==(o=c[20])&&r(t,"for",o),g&1048576&&p!==(p=c[20])&&r(e,"id",p),g&128&&(e.disabled=c[7]),g&8&&e.value!==c[3]&&B(e,c[3])},d(c){c&&(m(t),m(n),m(e),m(_),m(d)),a=!1,i()}}}function se(s){let t,u,o,n,e,p,_,d;return{c(){t=w("label"),u=O("创建超级用户并登录"),n=q(),e=w("input"),r(t,"for",o=s[20]),r(e,"type","password"),r(e,"minlength","10"),r(e,"id",p=s[20]),e.disabled=s[7],e.required=!0},m(a,i){h(a,t,i),z(t,u),h(a,n,i),h(a,e,i),B(e,s[4]),_||(d=L(e,"input",s[14]),_=!0)},p(a,i){i&1048576&&o!==(o=a[20])&&r(t,"for",o),i&1048576&&p!==(p=a[20])&&r(e,"id",p),i&128&&(e.disabled=a[7]),i&16&&e.value!==a[4]&&B(e,a[4])},d(a){a&&(m(t),m(n),m(e)),_=!1,d()}}}function ie(s){let t,u,o,n,e,p,_,d,a,i,c,g,C,k,A,$,v,I,y;return n=new N({props:{class:"form-field required",name:"email",$$slots:{default:[ne,({uniqueId:l})=>({20:l}),({uniqueId:l})=>l?1048576:0]},$$scope:{ctx:s}}}),p=new N({props:{class:"form-field required",name:"password",$$slots:{default:[le,({uniqueId:l})=>({20:l}),({uniqueId:l})=>l?1048576:0]},$$scope:{ctx:s}}}),d=new N({props:{class:"form-field required",name:"passwordConfirm",$$slots:{default:[se,({uniqueId:l})=>({20:l}),({uniqueId:l})=>l?1048576:0]},$$scope:{ctx:s}}}),{c(){t=w("form"),u=w("div"),u.innerHTML="<h4>创建您的第一个超级用户帐户以继续</h4>",o=q(),K(n.$$.fragment),e=q(),K(p.$$.fragment),_=q(),K(d.$$.fragment),a=q(),i=w("button"),i.innerHTML='<span class="txt">创建超级用户并登录</span> <i class="ri-arrow-right-line"></i>',c=q(),g=w("hr"),C=q(),k=w("label"),k.innerHTML='<i class="ri-upload-cloud-line"></i> <span class="txt">或者从你的备份中恢复</span>',A=q(),$=w("input"),r(u,"class","content txt-center m-b-base"),r(i,"type","submit"),r(i,"class","btn btn-lg btn-block btn-next"),F(i,"btn-disabled",s[7]),F(i,"btn-loading",s[0]),r(t,"class","block"),r(t,"autocomplete","off"),r(k,"for","backupFileInput"),r(k,"class","btn btn-lg btn-hint btn-transparent btn-block"),F(k,"btn-disabled",s[7]),F(k,"btn-loading",s[1]),r($,"id","backupFileInput"),r($,"type","file"),r($,"class","hidden"),r($,"accept",".zip")},m(l,b){h(l,t,b),z(t,u),z(t,o),D(n,t,null),z(t,e),D(p,t,null),z(t,_),D(d,t,null),z(t,a),z(t,i),h(l,c,b),h(l,g,b),h(l,C,b),h(l,k,b),h(l,A,b),h(l,$,b),s[15]($),v=!0,I||(y=[L(t,"submit",x(s[8])),L($,"change",s[16])],I=!0)},p(l,b){const H={};b&3145892&&(H.$$scope={dirty:b,ctx:l}),n.$set(H);const f={};b&3145864&&(f.$$scope={dirty:b,ctx:l}),p.$set(f);const T={};b&3145872&&(T.$$scope={dirty:b,ctx:l}),d.$set(T),(!v||b&128)&&F(i,"btn-disabled",l[7]),(!v||b&1)&&F(i,"btn-loading",l[0]),(!v||b&128)&&F(k,"btn-disabled",l[7]),(!v||b&2)&&F(k,"btn-loading",l[1])},i(l){v||(j(n.$$.fragment,l),j(p.$$.fragment,l),j(d.$$.fragment,l),v=!0)},o(l){E(n.$$.fragment,l),E(p.$$.fragment,l),E(d.$$.fragment,l),v=!1},d(l){l&&(m(t),m(c),m(g),m(C),m(k),m(A),m($)),S(n),S(p),S(d),s[15](null),I=!1,Z(y)}}}function ae(s){let t,u;return t=new R({props:{$$slots:{default:[ie]},$$scope:{ctx:s}}}),{c(){K(t.$$.fragment)},m(o,n){D(t,o,n),u=!0},p(o,[n]){const e={};n&2097407&&(e.$$scope={dirty:n,ctx:o}),t.$set(e)},i(o){u||(j(t.$$.fragment,o),u=!0)},o(o){E(t.$$.fragment,o),u=!1},d(o){S(t,o)}}}function ue(s,t,u){let o,{params:n}=t,e="",p="",_="",d=!1,a=!1,i,c;g();async function g(){if(!(n!=null&&n.token))return M("/");u(0,d=!0);try{const f=V(n==null?void 0:n.token);await P.collection("_superusers").getOne(f.id,{requestKey:"installer_token_check",headers:{Authorization:n==null?void 0:n.token}})}catch(f){f!=null&&f.isAbort||(X("The installer token is invalid or has expired."),M("/"))}u(0,d=!1),await Y(),i==null||i.focus()}async function C(){if(!o){u(0,d=!0);try{await P.collection("_superusers").create({email:e,password:p,passwordConfirm:_},{headers:{Authorization:n==null?void 0:n.token}}),await P.collection("_superusers").authWithPassword(e,p),M("/")}catch(f){P.error(f)}u(0,d=!1)}}function k(){c&&u(6,c.value="",c)}function A(f){f&&ee(`Note that we don't perform validations for the uploaded backup files. Proceed with caution and only if you trust the file source.

Do you really want to upload and initialize "${f.name}"?`,()=>{$(f)},()=>{k()})}async function $(f){if(!(!f||o)){u(1,a=!0);try{await P.backups.upload({file:f},{headers:{Authorization:n==null?void 0:n.token}}),await P.backups.restore(f.name,{headers:{Authorization:n==null?void 0:n.token}}),te("Please wait while extracting the uploaded archive!"),await new Promise(T=>setTimeout(T,2e3)),M("/")}catch(T){P.error(T)}k(),u(1,a=!1)}}function v(f){W[f?"unshift":"push"](()=>{i=f,u(5,i)})}function I(){e=this.value,u(2,e)}function y(){p=this.value,u(3,p)}function l(){_=this.value,u(4,_)}function b(f){W[f?"unshift":"push"](()=>{c=f,u(6,c)})}const H=f=>{var T,U;A((U=(T=f.target)==null?void 0:T.files)==null?void 0:U[0])};return s.$$set=f=>{"params"in f&&u(10,n=f.params)},s.$$.update=()=>{s.$$.dirty&3&&u(7,o=d||a)},[d,a,e,p,_,i,c,o,C,A,n,v,I,y,l,b,H]}class re extends G{constructor(t){super(),J(this,t,ue,ae,Q,{params:10})}}export{re as default};
